/**
 * generated by Xtext 2.19.0
 */
package org.xtext.example.mydsl.generator;

import java.util.ArrayList;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.xtext.generator.AbstractGenerator;
import org.eclipse.xtext.generator.IFileSystemAccess2;
import org.eclipse.xtext.generator.IGeneratorContext;
import org.eclipse.xtext.xbase.lib.InputOutput;
import org.xtext.example.mydsl.sat.And;
import org.xtext.example.mydsl.sat.BiImpl;
import org.xtext.example.mydsl.sat.Expression;
import org.xtext.example.mydsl.sat.Impl;
import org.xtext.example.mydsl.sat.Nand;
import org.xtext.example.mydsl.sat.Not;
import org.xtext.example.mydsl.sat.Or;

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
@SuppressWarnings("all")
public class SatGenerator extends AbstractGenerator {
  @Override
  public void doGenerate(final Resource resource, final IFileSystemAccess2 fsa, final IGeneratorContext context) {
    EObject expression = resource.getContents().get(0);
    SatGenerator.pretty_print(expression);
    InputOutput.<String>print("\n");
    fsa.generateFile("formula.cnf", SatGenerator.prop_to_dimacs(expression));
  }
  
  public static String prop_to_dimacs(final EObject formule) {
    String _xblockexpression = null;
    {
      SatGenerator.tab_symb.clear();
      SatGenerator.populate_tab_symb(formule);
      int _size = SatGenerator.tab_symb.size();
      String _plus = ("p cnf " + Integer.valueOf(_size));
      String _plus_1 = (_plus + " ");
      int _count_clauses = SatGenerator.count_clauses(formule);
      String _plus_2 = (_plus_1 + Integer.valueOf(_count_clauses));
      String _plus_3 = (_plus_2 + "\n");
      String _write_clauses = SatGenerator.write_clauses(formule);
      String _plus_4 = (_plus_3 + _write_clauses);
      _xblockexpression = (_plus_4 + " 0");
    }
    return _xblockexpression;
  }
  
  public static String write_clauses(final EObject formule) {
    String _switchResult = null;
    boolean _matched = false;
    if ((formule instanceof Or)) {
      _matched=true;
      String _write_clauses = SatGenerator.write_clauses(((Or) formule).getLeft());
      String _plus = (_write_clauses + " ");
      String _write_clauses_1 = SatGenerator.write_clauses(((Or) formule).getRight());
      _switchResult = (_plus + _write_clauses_1);
    }
    if (!_matched) {
      if ((formule instanceof And)) {
        _matched=true;
        String _write_clauses_2 = SatGenerator.write_clauses(((And) formule).getLeft());
        String _plus_1 = (_write_clauses_2 + " 0\n");
        String _write_clauses_3 = SatGenerator.write_clauses(((And) formule).getRight());
        _switchResult = (_plus_1 + _write_clauses_3);
      }
    }
    if (!_matched) {
      if ((formule instanceof Not)) {
        _matched=true;
        String _write_clauses_4 = SatGenerator.write_clauses(((Not) formule).getExpression());
        _switchResult = ("-" + _write_clauses_4);
      }
    }
    if (!_matched) {
      String _xifexpression = null;
      String _id = ((Expression) formule).getId();
      boolean _tripleNotEquals = (_id != null);
      if (_tripleNotEquals) {
        int _indexOf = SatGenerator.tab_symb.indexOf(((Expression) formule).getId());
        int _plus_2 = (_indexOf + 1);
        _xifexpression = ("" + Integer.valueOf(_plus_2));
      } else {
        _xifexpression = "ERROR";
      }
      _switchResult = _xifexpression;
    }
    return _switchResult;
  }
  
  private static ArrayList<String> tab_symb = new ArrayList<String>();
  
  public static int populate_tab_symb(final EObject formule) {
    int _switchResult = (int) 0;
    boolean _matched = false;
    if ((formule instanceof Or)) {
      _matched=true;
      int _populate_tab_symb = SatGenerator.populate_tab_symb(((Or) formule).getLeft());
      int _populate_tab_symb_1 = SatGenerator.populate_tab_symb(((Or) formule).getRight());
      _switchResult = (_populate_tab_symb + _populate_tab_symb_1);
    }
    if (!_matched) {
      if ((formule instanceof And)) {
        _matched=true;
        int _populate_tab_symb_2 = SatGenerator.populate_tab_symb(((And) formule).getLeft());
        int _populate_tab_symb_3 = SatGenerator.populate_tab_symb(((And) formule).getRight());
        _switchResult = (_populate_tab_symb_2 + _populate_tab_symb_3);
      }
    }
    if (!_matched) {
      if ((formule instanceof Not)) {
        _matched=true;
        _switchResult = SatGenerator.populate_tab_symb(((Not) formule).getExpression());
      }
    }
    if (!_matched) {
      int _xifexpression = (int) 0;
      String _id = ((Expression) formule).getId();
      boolean _tripleNotEquals = (_id != null);
      if (_tripleNotEquals) {
        int _xblockexpression = (int) 0;
        {
          String id = ((Expression) formule).getId();
          int _xifexpression_1 = (int) 0;
          boolean _contains = SatGenerator.tab_symb.contains(id);
          boolean _not = (!_contains);
          if (_not) {
            int _xblockexpression_1 = (int) 0;
            {
              SatGenerator.tab_symb.add(id);
              _xblockexpression_1 = 1;
            }
            _xifexpression_1 = _xblockexpression_1;
          } else {
            _xifexpression_1 = 0;
          }
          _xblockexpression = _xifexpression_1;
        }
        _xifexpression = _xblockexpression;
      } else {
        _xifexpression = 0;
      }
      _switchResult = _xifexpression;
    }
    return _switchResult;
  }
  
  public static int count_clauses(final EObject formule) {
    int _xifexpression = (int) 0;
    if ((formule instanceof And)) {
      int _count_clauses = SatGenerator.count_clauses(((And) formule).getRight());
      int _count_clauses_1 = SatGenerator.count_clauses(((And) formule).getLeft());
      _xifexpression = (_count_clauses + _count_clauses_1);
    } else {
      _xifexpression = 1;
    }
    return _xifexpression;
  }
  
  public static void pretty_print(final EObject formule) {
    boolean _matched = false;
    if ((formule instanceof BiImpl)) {
      _matched=true;
      InputOutput.<String>print("(");
      SatGenerator.pretty_print(((BiImpl) formule).getLeft());
      InputOutput.<String>print(" <-> ");
      SatGenerator.pretty_print(((BiImpl) formule).getRight());
      InputOutput.<String>print(")");
    }
    if (!_matched) {
      if ((formule instanceof Impl)) {
        _matched=true;
        InputOutput.<String>print("(");
        SatGenerator.pretty_print(((Impl) formule).getLeft());
        InputOutput.<String>print(" -> ");
        SatGenerator.pretty_print(((Impl) formule).getRight());
        InputOutput.<String>print(")");
      }
    }
    if (!_matched) {
      if ((formule instanceof Or)) {
        _matched=true;
        InputOutput.<String>print("(");
        SatGenerator.pretty_print(((Or) formule).getLeft());
        InputOutput.<String>print(" OR ");
        SatGenerator.pretty_print(((Or) formule).getRight());
        InputOutput.<String>print(")");
      }
    }
    if (!_matched) {
      if ((formule instanceof And)) {
        _matched=true;
        InputOutput.<String>print("(");
        SatGenerator.pretty_print(((And) formule).getLeft());
        InputOutput.<String>print(" AND ");
        SatGenerator.pretty_print(((And) formule).getRight());
        InputOutput.<String>print(")");
      }
    }
    if (!_matched) {
      if ((formule instanceof Nand)) {
        _matched=true;
        InputOutput.<String>print("(");
        SatGenerator.pretty_print(((Nand) formule).getLeft());
        InputOutput.<String>print(" NAND ");
        SatGenerator.pretty_print(((Nand) formule).getRight());
        InputOutput.<String>print(")");
      }
    }
    if (!_matched) {
      if ((formule instanceof Not)) {
        _matched=true;
        InputOutput.<String>print("(");
        InputOutput.<String>print("NOT ");
        SatGenerator.pretty_print(((Not) formule).getExpression());
        InputOutput.<String>print(")");
      }
    }
    if (!_matched) {
      {
        String _id = ((Expression) formule).getId();
        boolean _tripleNotEquals = (_id != null);
        if (_tripleNotEquals) {
          InputOutput.<String>print(((Expression) formule).getId());
        }
        String _val = ((Expression) formule).getVal();
        boolean _tripleNotEquals_1 = (_val != null);
        if (_tripleNotEquals_1) {
          InputOutput.<String>print(((Expression) formule).getVal());
        }
      }
    }
  }
}
